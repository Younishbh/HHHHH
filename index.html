<!doctype html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>متصفح أفلام — شبكتي</title>
  <meta name="description" content="متصفح أفلام محلي يدعم روابط m3u8، تفاصيل، فيديو HLS، تنظيم بالقوائم والفئات، وحفظ محلي">
  <link href="https://cdn.jsdelivr.net/npm/modern-normalize/modern-normalize.css" rel="stylesheet">
  <style>
    :root{--bg:#0b0f15;--card:#0f1720;--muted:#98a0aa;--accent:#ff6b6b;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, Tahoma, Arial, sans-serif;background:linear-gradient(180deg,#05060a,var(--bg));color:#e6eef8}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;gap:12px}
    header .brand{display:flex;align-items:center;gap:12px}
    h1{font-size:18px;margin:0}
    .container{max-width:1200px;margin:12px auto;padding:0 16px}.toolbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.search{flex:1;min-width:200px}
input[type=text], select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.btn{padding:9px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),#ff8b8b);border:0;color:#0b0b0b}

.layout{display:grid;grid-template-columns:1fr;gap:14px}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}
.card{background:var(--card);border-radius:10px;padding:8px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.6);cursor:pointer}
.poster{width:100%;height:240px;object-fit:cover;border-radius:6px;background:#07080b}
.meta{padding:8px}
.title{font-size:14px;margin:0 0 6px 0}
.sub{font-size:12px;color:var(--muted)}

.sidebar{display:flex;gap:10px;flex-direction:column}
.row{display:flex;gap:8px;align-items:center}

/* modal player */
.modal{position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(2,6,10,0.7);display:flex;align-items:center;justify-content:center;padding:18px;z-index:40;}
.modal .box{width:100%;max-width:1100px;background:linear-gradient(180deg,#071018, #08141b);border-radius:12px;padding:12px}
video{width:100%;height:520px;background:#000;border-radius:6px}
.details{display:flex;gap:12px;margin-top:10px}
.details .left{flex:1}
.details .right{width:320px}
.tag{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);font-size:12px;margin-left:6px}

.empty{padding:26px;text-align:center;color:var(--muted)}

footer{padding:18px;text-align:center;color:var(--muted)}

@media (max-width:900px){ video{height:260px}.poster{height:160px} .details{flex-direction:column}.details .right{width:100%} }

  </style>
</head>
<body>
  <header>
    <div class="brand">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><rect width="24" height="24" rx="6" fill="#ff6b6b"/></svg>
      <div>
        <h1>متصفح أفلام — شبكتي</h1>
        <div class="sub">شبكة أفلام محلية • أضف روابط m3u8 وشغّل</div>
      </div>
    </div>
    <div class="toolbar">
      <div style="width:320px" class="search"><input id="search" type="text" placeholder="ابحث عن فيلم أو سنة أو فئة"></div>
      <select id="sort"><option value="new">الأحدث أولًا</option><option value="az">أ - ي</option><option value="year">السنة</option></select>
      <button class="btn" id="addOpen">أضف فيلم</button>
      <button class="btn" id="importBtn">استيراد/تصدير</button>
    </div>
  </header>  <main class="container">
    <div class="layout">
      <section>
        <div id="grid" class="grid" aria-live="polite"></div>
        <div id="pager" style="margin-top:12px;display:flex;gap:8px;justify-content:center"></div>
      </section>
    </div><div id="empty" class="empty" style="display:none">لم يتم العثور على أفلام — أضف روابط لتبدأ</div>

  </main>  <footer>صُنِع بواسطة شبكتي — دعم HLS عبر hls.js</footer>  <!-- Player modal -->  <div id="playerModal" class="modal" style="display:none">
    <div class="box">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
        <div id="playerTitle" style="font-weight:600"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="openInTab">افتح في تبويب جديد</button>
          <button class="btn" id="closePlayer">إغلاق</button>
        </div>
      </div>
      <div style="margin-top:10px">
        <video id="videoPlayer" controls playsinline crossorigin="anonymous"></video>
      </div>
      <div class="details">
        <div class="left">
          <div id="desc" class="sub"></div>
          <div style="margin-top:8px"><span id="year" class="tag"></span> <span id="tags" class="tag"></span></div>
        </div>
        <div class="right">
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <button class="btn primary" id="favBtn">إضافة للمفضلة</button>
            <button class="btn" id="copyLink">انسخ الرابط</button>
          </div>
          <div class="sub">روابط بديلة:</div>
          <div id="altList" style="margin-top:8px"></div>
        </div>
      </div>
    </div>
  </div>  <!-- Add / Import Modal (simple) -->  <div id="addModal" class="modal" style="display:none">
    <div class="box">
      <h3>أضف فيلم جديد</h3>
      <div style="display:grid;gap:8px;margin-top:8px">
        <input id="m_title" type="text" placeholder="عنوان الفيلم">
        <input id="m_year" type="text" placeholder="السنة (اختياري)">
        <input id="m_tags" type="text" placeholder="فئات مفصولة بفواصل (مثال: أكشن,دراما)">
        <input id="m_poster" type="url" placeholder="رابط صورة الغلاف (اختياري)">
        <input id="m_url" type="url" placeholder="رابط m3u8 (مطلوب)">
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
          <button class="btn" id="cancelAdd">إلغاء</button>
          <button class="btn primary" id="saveAdd">حفظ</button>
        </div>
      </div>
    </div>
  </div>  <!-- Import/Export modal -->  <div id="impModal" class="modal" style="display:none">
    <div class="box">
      <h3>استيراد / تصدير القائمة</h3>
      <textarea id="impArea" style="width:100%;height:220px;background:transparent;color:inherit;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.04)"></textarea>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
        <button class="btn" id="impCancel">إغلاق</button>
        <button class="btn primary" id="impLoad">استيراد</button>
      </div>
    </div>
  </div>  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>  <script>
    // عناصر
    const grid = document.getElementById('grid');
    const search = document.getElementById('search');
    const sort = document.getElementById('sort');
    const playerModal = document.getElementById('playerModal');
    const videoPlayer = document.getElementById('videoPlayer');
    const playerTitle = document.getElementById('playerTitle');
    const desc = document.getElementById('desc');
    const yearTag = document.getElementById('year');
    const tagsEl = document.getElementById('tags');
    const altList = document.getElementById('altList');
    const favBtn = document.getElementById('favBtn');
    const closePlayer = document.getElementById('closePlayer');
    const openInTab = document.getElementById('openInTab');

    const addOpen = document.getElementById('addOpen');
    const addModal = document.getElementById('addModal');
    const impModal = document.getElementById('impModal');
    const importBtn = document.getElementById('importBtn');

    const impArea = document.getElementById('impArea');

    // بيانات مبدئية تشتمل على الرابط الذي أعطيتني
    const starter = [
      {id:uid(), title:'فيلم تجريبي HD', year:'2025', tags:['تجريبي','دراما'], poster:'', urls:[
        'https://s1-hls1-cdn54.strmupcdn.cc/hls/U3yy9GCGPDUibEAswx18yRWSjdQsGf/index_854x480.m3u8?token=f3d51a94a24d1f29e20c89f26b4f6c7d-1760000736-2a09%3Abac5%3A41b2%3A2682%3A%3A3d6%3Ae-09d42d55a2d6d8a879191837e9c3970fccaae3200d4d062f61025b66e4737a5d'
      ]}
    ];

    function uid(){ return Math.random().toString(36).slice(2,10) }

    // إدارة التخزين
    function load(){ try{ const raw = localStorage.getItem('movies_v2'); if(raw) return JSON.parse(raw); }catch(e){} return starter.slice(); }
    function save(data){ localStorage.setItem('movies_v2', JSON.stringify(data)); }

    let movies = load();
    let page = 1; const perPage = 12;

    // رندر الشبكة
    function render(){
      const q = search.value.trim().toLowerCase();
      let list = movies.filter(m=> (!q) || (m.title||'').toLowerCase().includes(q) || (m.tags||[]).join(',').toLowerCase().includes(q) || (m.year||'').includes(q));
      if(sort.value==='az') list = list.sort((a,b)=> (a.title||'').localeCompare(b.title||''));
      else if(sort.value==='year') list = list.sort((a,b)=> (b.year||'0') - (a.year||'0'));
      else list = list.sort((a,b)=> (b.added||0) - (a.added||0));

      const total = list.length; const pages = Math.max(1, Math.ceil(total/perPage)); if(page>pages) page=pages;
      const start = (page-1)*perPage; const pageItems = list.slice(start, start+perPage);

      grid.innerHTML='';
      if(pageItems.length===0){ document.getElementById('empty').style.display = 'block'; } else document.getElementById('empty').style.display='none';

      pageItems.forEach(m=>{
        const el = document.createElement('div'); el.className='card';
        el.innerHTML = `\n          <img loading="lazy" src="${m.poster||'data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'400\\' height=\\'240\\'><rect width=\\'100%\\' height=\\'100%\\' fill=\\'%23070b0f\\'/></svg>'}" class="poster" alt="${escapeHtml(m.title)}">\n          <div class="meta">\n            <div class="title">${escapeHtml(m.title)}</div>\n            <div class="sub">${m.year||''} • ${m.tags? m.tags.join(', '):''}</div>\n          </div>\n        `;
        el.addEventListener('click', ()=>openPlayer(m));
        grid.appendChild(el);
      });

      renderPager(pages);
    }

    function renderPager(pages){
      const pager = document.getElementById('pager'); pager.innerHTML='';
      for(let i=1;i<=pages;i++){
        const b = document.createElement('button'); b.className='btn'; b.textContent = i; if(i===page) b.classList.add('primary');
        b.addEventListener('click', ()=>{ page=i; render(); }); pager.appendChild(b);
      }
    }

    function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>\"']/g, function(c){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]; }); }

    // Player handling
    let hls = null; let current = null;
    function openPlayer(m){ current = m; playerTitle.textContent = m.title || 'بدون عنوان'; desc.textContent = m.description||''; yearTag.textContent = m.year||''; tagsEl.textContent = (m.tags||[]).join(', ');
      altList.innerHTML=''; (m.urls||[]).forEach((u,idx)=>{ const d = document.createElement('div'); d.className='sub'; d.style.marginBottom='6px'; d.innerHTML = `<a href=\"#\" data-url=\"${u}\">المصدر ${idx+1}</a>`; d.querySelector('a').addEventListener('click', (e)=>{ e.preventDefault(); playUrl(u); }); altList.appendChild(d); });
      playUrl((m.urls&&m.urls[0])||'');
      playerModal.style.display='flex';
    }

    function playUrl(u){ if(hls){ try{ hls.destroy(); }catch(e){} hls=null; }
      if(!u){ alert('لا يوجد رابط تشغيل'); return; }
      if(videoPlayer.canPlayType('application/vnd.apple.mpegurl')){ videoPlayer.src = u; videoPlayer.play().catch(()=>{}); }
      else if(Hls.isSupported()){
        hls = new Hls(); hls.loadSource(u); hls.attachMedia(videoPlayer); hls.on(Hls.Events.MANIFEST_PARSED, ()=> videoPlayer.play().catch(()=>{}));
        hls.on(Hls.Events.ERROR, function(event, data){ console.warn('HLS error', data); });
      } else { alert('المتصفح لا يدعم HLS'); }
    }

    closePlayer.addEventListener('click', ()=>{ playerModal.style.display='none'; try{ if(hls) hls.destroy(); }catch(e){} videoPlayer.pause(); videoPlayer.src=''; });
    openInTab.addEventListener('click', ()=>{ if(!current||!current.urls||!current.urls[0]) return alert('لا يوجد رابط'); window.open(current.urls[0], '_blank'); });

    // إضافة / استيراد
    addOpen.addEventListener('click', ()=>{ addModal.style.display='flex'; });
    document.getElementById('cancelAdd').addEventListener('click', ()=> addModal.style.display='none');
    document.getElementById('saveAdd').addEventListener('click', ()=>{
      const t = document.getElementById('m_title').value.trim(); const u = document.getElementById('m_url').value.trim(); if(!u||!t){ alert('الرجاء إدخال عنوان ورابط m3u8'); return; }
      const item = { id: uid(), title: t, year: document.getElementById('m_year').value.trim(), tags: document.getElementById('m_tags').value.split(',').map(s=>s.trim()).filter(Boolean), poster: document.getElementById('m_poster').value.trim(), urls:[u], added: Date.now() };
      movies.unshift(item); save(movies); addModal.style.display='none'; render();
      document.getElementById('m_title').value=''; document.getElementById('m_url').value=''; document.getElementById('m_poster').value='';
    });

    importBtn.addEventListener('click', ()=>{ impModal.style.display='flex'; impArea.value = JSON.stringify(movies, null, 2); });
    document.getElementById('impCancel').addEventListener('click', ()=> impModal.style.display='none');
    document.getElementById('impLoad').addEventListener('click', ()=>{
      try{ const parsed = JSON.parse(impArea.value); if(!Array.isArray(parsed)) throw new Error('قائمة خاطئة'); movies = parsed; save(movies); impModal.style.display='none'; render(); }catch(e){ alert('تعذر الاستيراد: ' + e.message); }
    });

    // نسخ الرابط للمشغل
    document.getElementById('copyLink').addEventListener('click', ()=>{
      if(!current||!current.urls||!current.urls[0]) return alert('لا يوجد رابط'); navigator.clipboard.writeText(current.urls[0]).then(()=>alert('تم نسخ الرابط'));
    });

    // البحث والفرز
    search.addEventListener('input', ()=>{ page=1; render(); }); sort.addEventListener('change', ()=> render());

    // استيراد/تصدير بسيط (زر تنزيل)
    document.getElementById('impCancel');

    // تحميل أولي
    render();

    // تحرير بسيط: حذف/تعديل — يمكن إضافته لاحقاً

    // نصيحة: عند نشر على استضافة، تأكد من سياسة CORS للروابط m3u8
  </script></body>
</html>
